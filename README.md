# Multi-Host Network Topology Discovery

## 项目简介

本项目旨在**在本地集中控制并感知多主机的网络状态与物理/逻辑拓扑**。在一个由多台主机、多网口相互连接组成的实验环境中，本项目能够：

* 通过 **SSH（root 权限）** 远程访问多台主机
* 自动采集各主机的网络接口、链路状态与邻居信息
* **推断并重建网络拓扑结构**（主机—网口—链路）
* 辅助验证链路是否正常、连接关系是否符合预期
* 为后续的网络实验、性能评估与故障定位提供基础能力

该项目特别适用于：

* 网络系统/交换机/数据中心网络相关科研实验
* 多机 testbed 拓扑验证
* DPDK、RDMA、可编程网络等实验环境的基础设施管理

---

## 使用场景

假设你有：

* **9 台主机**（Host0 ~ Host8）
* 每台主机具有 **多个物理网口**（如 eth0, eth1, eno1, enpXsY 等）
* 主机之间通过直连网线或交换设备互连
* 本地控制节点可通过 SSH 访问所有主机，且具备 root 权限

你希望：

* 自动识别：

  * 每台主机有哪些网口
  * 每个网口是否 up / down
  * 哪些网口之间是互相连接的
* 构建一个**可视化/结构化的网络拓扑描述**
* 快速检查是否存在：

  * 断链
  * 接错线
  * 单向链路
  * 未预期的连接

---

## 核心设计目标

1. **无需人工配置拓扑**
   通过主动探测 + 主机侧信息采集，自动感知网络结构。

2. **对网络类型友好**
   既支持普通以太网，也为 DPDK / 实验性网络环境预留扩展空间。

3. **可验证、可复现**
   所有拓扑结论均可追溯到原始观测数据（接口信息、邻居信息、链路探测结果）。

4. **模块化设计**
   拓扑感知、数据采集、推断逻辑、展示方式解耦，便于扩展。

---

## 系统架构

```
+-------------------+
|  Control Node     |
|-------------------|
| SSH Orchestrator  |
| Topology Engine   |
| Validation Logic  |
+---------+---------+
          |
   SSH (root)
          |
+---------v---------+      +---------v---------+
|      Host 0       | ...  |      Host 8       |
|  - NICs           |      |  - NICs           |
|  - Link State     |      |  - Link State     |
|  - Neighbor Info  |      |  - Neighbor Info  |
+-------------------+      +-------------------+
```

---

## 拓扑感知思路

### 1. 主机侧信息采集

通过 SSH 在每台主机上采集：

* 网络接口列表

  * 接口名称
  * MAC 地址
  * 速率 / 双工模式
  * up/down 状态
* 链路层信息

  * ethtool 链路状态
  * 驱动与设备信息

### 2. 邻居发现（Neighbor Discovery）

优先采用 **链路层邻居发现机制**：

* LLDP（若环境支持）
* 自定义 L2 探测（如发送带唯一标识的探测帧）

目标是获得如下关系：

```
HostA:eth1  <---->  HostB:eth3
```

### 3. 主动链路探测（可选）

在无 LLDP 或受限环境中，可通过：

* 点对点 ARP / ICMP 探测
* 临时配置 link-local IP 进行互测
* 端口级别的并行探测

结合 MAC/IP 映射关系反推出物理连接。

### 4. 拓扑推断

控制节点将所有主机的观测结果进行融合，构建：

* **节点（Node）**：主机
* **端口（Port）**：物理网口
* **链路（Link）**：端口之间的连接关系

最终形成一张完整的拓扑图。

---

## 输出结果

项目可输出多种形式的拓扑描述：

* 结构化数据

  * JSON / YAML 拓扑文件
* 人类可读形式

  * 文本化连接表
* （可扩展）

  * Graphviz DOT
  * 可视化拓扑图

示例（逻辑结构）：

```json
{
  "hosts": {
    "host0": {
      "interfaces": {
        "eth1": {"peer": "host3:eth0"},
        "eth2": {"peer": "host5:eth1"}
      }
    }
  }
}
```

---

## 权限与安全假设

* 控制节点对所有主机 **具备 SSH 访问能力**
* 所有主机允许 **root 权限执行网络相关命令**
* 项目默认运行在**可信实验环境**中，不面向公网

---

## 项目目录结构（建议）

```
network-topology-discovery/
├── README.md
├── inventory/
│   └── hosts.yaml        # 主机列表与 SSH 信息
├── collector/
│   ├── interfaces.py     # 网口信息采集
│   ├── link_state.py     # 链路状态采集
│   └── neighbor.py       # 邻居发现
├── engine/
│   ├── infer.py          # 拓扑推断逻辑
│   └── validate.py       # 链路一致性校验
├── output/
│   ├── topology.json
│   └── topology.txt
└── scripts/
    └── discover.py       # 一键拓扑发现入口
```

---

## 可扩展方向

* 支持 DPDK / SR-IOV / VF 网口
* 与交换机（ToR）协同感知
* 拓扑变化检测（热插拔、断链）
* 与实验框架集成（如自动验证 testbed 连线正确性）

---

## 适用人群

* 网络系统/体系结构研究人员
* 数据中心网络实验维护者
* FPGA / DPDK / 可编程交换机实验用户

---

## License

MIT License（可按需要调整）

